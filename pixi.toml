[workspace]
name = "so101-ros-physical-ai"
description = "SO-101 ROS 2 stack tooling (Rerun bridge, utilities, dev env)"
channels = ["conda-forge"]
platforms = ["linux-64"]
version = "0.1.0"

[feature.bridge.dependencies]
python = "3.12.*"
pyyaml = ">=6.0.3,<7"
numpy = ">=2.4.2,<3"
gradio = ">=6.5.1,<7"
rerun-sdk = ">=0.29.2,<0.30"

[feature.bridge.pypi-dependencies]
gradio-rerun = ">=0.29.1, <0.30"

[feature.bridge.tasks]
# Run the bridge in a ROS-aware shell:
# - sources ROS Jazzy
# - sources your overlay (if built)
# - runs with pixi's python (so rerun is available)
# - forwards all extra args to the Python script
bridge = { cmd = "bash -c 'source /opt/ros/jazzy/setup.bash && source ${ROS_WS:-$HOME/ros2_ws}/install/setup.bash 2>/dev/null || true && exec python scripts/so101_ros2_to_rerun.py \"$@\"' -- " }
replay = { cmd = "bash -c 'source /opt/ros/jazzy/setup.bash && source ${ROS_WS:-$HOME/ros2_ws}/install/setup.bash 2>/dev/null || true && exec python scripts/so101_episode_viewer_ros2.py \"$@\"' -- " }


# Launch the native Rerun viewer (connect the bridge with --connect)
viewer = { cmd = "python -m rerun" }


# --- Extra feature: LeRobot tooling (added as a second env) ---
[feature.lerobot.dependencies]
# LeRobot docs commonly recommend ffmpeg in the conda env
python = "3.12.*"
pyyaml = ">=6.0.3,<7"
numpy = ">=2.4.2,<3"
ffmpeg = "*"

[feature.lerobot.pypi-dependencies]
lerobot = "*"
parquet-tools = ">=0.2.16, <0.3"

[feature.lerobot.tasks]
lerobot-info = "lerobot-info"
convert = { cmd = "bash -c 'source /opt/ros/jazzy/setup.bash && source ${ROS_WS:-$HOME/ros2_ws}/install/setup.bash 2>/dev/null || true; if [ \"${1-}\" = \"--\" ]; then shift; fi; exec python -m rosbag_to_lerobot.cli \"$@\"' --" }

# --- Environments ---
[environments]
# Default env: just the bridge tooling
default = ["bridge"]

# Second env: LeRobot
lerobot = ["lerobot"]


